import{Component}from"inferno";import PropTypes from"prop-types";import gud from"gud";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var MAX_SIGNED_31_BIT_INT=1073741823;function objectIs(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function createEventEmitter(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter(function(t){return t!==e})},get:function(){return e},set:function(r,n){e=r,t.forEach(function(t){return t(e,n)})}}}function onlyChild(e){return Array.isArray(e)?e[0]:e}function createInfernoContext(e,t){var r="__create-inferno-context-"+gud()+"__",n=function(e){function n(){var e,t;_classCallCheck(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return _defineProperty(_assertThisInitialized(_assertThisInitialized(t=_possibleConstructorReturn(this,(e=_getPrototypeOf(n)).call.apply(e,[this].concat(o))))),"emitter",createEventEmitter(t.props.value)),t}return _inherits(n,Component),_createClass(n,[{key:"getChildContext",value:function(){return _defineProperty({},r,this.emitter)}},{key:"componentWillReceiveProps",value:function(e){if(this.props.value!==e.value){var r,n=this.props.value,o=e.value;objectIs(n,o)?r=0:(r="function"==typeof t?t(n,o):MAX_SIGNED_31_BIT_INT,0!==(r|=0)&&this.emitter.set(e.value,r))}}},{key:"render",value:function(){return this.props.children}}]),n}();_defineProperty(n,"childContextTypes",_defineProperty({},r,PropTypes.object.isRequired));var o=function(t){function n(){var e,t;_classCallCheck(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return _defineProperty(_assertThisInitialized(_assertThisInitialized(t=_possibleConstructorReturn(this,(e=_getPrototypeOf(n)).call.apply(e,[this].concat(o))))),"observedBits",void 0),_defineProperty(_assertThisInitialized(_assertThisInitialized(t)),"state",{value:t.getValue()}),_defineProperty(_assertThisInitialized(_assertThisInitialized(t)),"onUpdate",function(e,r){0!=((0|t.observedBits)&r)&&t.setState({value:t.getValue()})}),t}return _inherits(n,Component),_createClass(n,[{key:"componentWillReceiveProps",value:function(e){var t=e.observedBits;this.observedBits=null==t?MAX_SIGNED_31_BIT_INT:t}},{key:"componentDidMount",value:function(){this.context[r]&&this.context[r].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=null==e?MAX_SIGNED_31_BIT_INT:e}},{key:"componentWillUnmount",value:function(){this.context[r]&&this.context[r].off(this.onUpdate)}},{key:"getValue",value:function(){return this.context[r]?this.context[r].get():e}},{key:"render",value:function(){return onlyChild(this.props.children)(this.state.value)}}]),n}();return _defineProperty(o,"contextTypes",_defineProperty({},r,PropTypes.object)),{Provider:n,Consumer:o}}export default createInfernoContext;
